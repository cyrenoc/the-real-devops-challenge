pipeline {

    agent any

    environment {
	PASS = credentials('registry-pass')
    }

    stages {

        stage('Build') {
            steps {
		     sh "echo hola build"
                     sh "pip install tox"
                     sh "/usr/bin/python -m pip install --upgrade pip"
                     //sh "sudo apt-get install -y1  python-virtualenv virtualenv"
                     //sh "pip install virtualenv"
                     //sh "virtualenv -p python .venv"	   
                     //sh "source .venv/bin/activate"
                     sh "pip install -r requirements.txt"
                     //sh "export MONGO_URI=mongodb://appAdmin:secret@127.0.0.1:27017/myNewDatabase"
                     //sh "python app.py"
                     sh "./start.sh &"
                       
                    }
		}
        stage('Test') {
            steps {
		      //sh './jenkins/test/test.sh mvn test' 
                   sh "echo hola test"
                   sh "docker run  -v /home/ubuntu/jenkins/the-real-devops-challenge:/tmp/app -w /tmp/app --rm painless/tox /bin/bash tox"
                  }
		}
		
        stage('Deploy') {
            steps {
       		   //sh './jenkins/deploy/deploy.sh'
                   sh "echo hola deploy"
            }
         }
    }
}


pipeline {

    agent {
      any {
       image 'ubuntu'
       args '-p 8085:8085 -u 0'
      }
   }

    environment {
	PASS = credentials('registry-pass')
    }

    stages {

        stage('Build') {
            steps {
		     sh "echo hola build"
                     sh "pip install tox"
                     sh "/usr/bin/python -m pip install --upgrade pip"
                     sh "pip install -r requirements.txt"
                     sh "whoami"
                     sh "./insertUser.sh"         


                    }
		}
        stage('Test') {
            steps {
		      //sh './jenkins/test/test.sh mvn test' 
                   sh "echo hola test"
                   sh "docker run  -v /home/ubuntu/jenkins/the-real-devops-challenge:/tmp/app -w /tmp/app --rm painless/tox /bin/bash tox"
                  }
		}
		
        stage('Deploy') {
            steps {
       		   //sh './jenkins/deploy/deploy.sh'
                   sh "echo hola deploy"
                   sh "./start.sh &"
   
            }
         }
    }
}

